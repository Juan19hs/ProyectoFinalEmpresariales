<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito - Sistema de Inventario</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            border-bottom: 3px solid #667eea;
            margin-bottom: 30px;
        }

        .container-main {
            max-width: 1400px;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            margin: 0 auto 30px;
        }

        .alert {
            border-radius: 8px;
            border-left: 4px solid;
        }
    </style>
</head>
<body>

<!-- HEADER IGUAL AL LISTADO DE PRODUCTOS -->
<div class="header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1><i class="bi bi-diagram-3"></i> Sistema de Inventario</h1>
            <p class="mb-0">Carrito de Compras</p>
        </div>

        <div>
            <!-- Usuario logueado -->
            <p class="mb-0">
                <i class="bi bi-person-circle"></i>
                <strong sec:authentication="principal.username"></strong>
            </p>

            <a href="/logout" class="btn btn-primary mt-2"
               style="background: linear-gradient(135deg,#3b82f6,#06b6d4); border: none;">
                <i class="bi bi-box-arrow-right"></i> Cerrar Sesión
            </a>

            <!-- Panel Productos -->
            <a href="/productos" class="btn btn-primary btn-lg mt-2 ms-2"
               style="background: linear-gradient(135deg,#3b82f6,#06b6d4); border: none;">
                <i class="bi bi-box-seam"></i> Productos
            </a>
        </div>
    </div>
</div>

<!-- CONTENEDOR PRINCIPAL -->
<div class="container-main">

    <h2><i class="bi bi-cart3"></i> Carrito de Compras</h2>

    <!-- SI EL CARRITO ESTÁ VACÍO -->
    <div th:if="${productosCarrito == null || productosCarrito.isEmpty()}"
         class="alert alert-info mt-3">
        <i class="bi bi-info-circle"></i> No hay productos en el carrito.
        <a href="/productos" class="alert-link">Volver al catálogo</a>
    </div>

    <!-- SI HAY PRODUCTOS -->
    <div th:if="${productosCarrito != null && !productosCarrito.isEmpty()}"
         class="table-responsive mt-3">

        <table class="table table-striped table-hover align-middle">
            <thead class="table-light">
                <tr>
                    <th>ID</th>
                    <th>Código</th>
                    <th>Nombre</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Subtotal</th>
                    <th>Acciones</th>
                </tr>
            </thead>

            <tbody>
                <tr th:each="p : ${productosCarrito}">
                    <td th:text="${p.id}"></td>

                    <td>
                        <code style="color:#667eea; font-weight:bold;" 
                              th:text="${p.codigo}"></code>
                    </td>

                    <td th:text="${p.nombre}"></td>

                    <td th:text="${cantidades[p.id]}"></td>

                    <td th:text="${'$' + #numbers.formatDecimal(p.precio, 1, 2)}"></td>

                    <td th:text="${'$' + #numbers.formatDecimal(p.precio * cantidades[p.id], 1, 2)}"></td>

                    <td>
                        <a th:href="@{/carrito/eliminar/{id}(id=${p.id})}"
                           class="btn btn-danger btn-sm">
                            <i class="bi bi-trash"></i> Eliminar
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="mt-3 text-end">
            <h4>Total: 
                <span th:text="${'$' + #numbers.formatDecimal(totalCarrito, 1, 2)}"></span>
            </h4>
        </div>
    </div>

    <!-- BOTÓN SEGUIR COMPRANDO -->
    <div class="mt-3">
        <a href="/productos" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Seguir comprando
        </a>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
